<!DOCTYPE html><html lang="en"><head><title>üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥</title><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="yandex-verification" content="39324391851d1a5d"/><meta name="google-site-verification" content="pnATuZP_aTcMjckmXnh2j6oO8Mk9YXUA7GfE7UO4QXk"/><link rel="stylesheet" href="/assets/css/site.css"/><meta property="og:type" content="article"/><meta property="og:site_name" content="@rapkin | Software developer"/><meta itemProp="og:title" content="üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥"/><meta itemProp="name" content="üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥"/><meta name="author" content="Mikola Parfenyuck"/><meta property="article:author" content="Mikola Parfenyuck"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@i_rapkin"/><meta name="twitter:title" content="üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥"/><meta name="description" content="–†–æ–∑—Ä–æ–±–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Ä–æ–∑–º—ñ—Ç–∫–∏ –º—ñ—Å—Ç –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Python, Shapely —Ç–∞ OpenStreetMap"/><meta itemProp="description" content="–†–æ–∑—Ä–æ–±–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Ä–æ–∑–º—ñ—Ç–∫–∏ –º—ñ—Å—Ç –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Python, Shapely —Ç–∞ OpenStreetMap"/><meta property="og:description" content="–†–æ–∑—Ä–æ–±–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Ä–æ–∑–º—ñ—Ç–∫–∏ –º—ñ—Å—Ç –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Python, Shapely —Ç–∞ OpenStreetMap"/><meta name="twitter:description" content="–†–æ–∑—Ä–æ–±–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Ä–æ–∑–º—ñ—Ç–∫–∏ –º—ñ—Å—Ç –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Python, Shapely —Ç–∞ OpenStreetMap"/><meta itemProp="image" content="https://rapkin.com.ua/assets/optimized-img/segmentation-title.png"/><meta property="og:image" content="https://rapkin.com.ua/assets/optimized-img/segmentation-title.png"/><meta name="twitter:image" content="https://rapkin.com.ua/assets/optimized-img/segmentation-title.png"/><meta name="google" content="nositelinkssearchbox"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":"Mikola Parfenyuck","headline":"üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥","datePublished":"2019-10-03T21:42:13.000Z","publisher":{"@type":"Organization","name":"rapkin","url":"https://rapkin.com.ua","logo":{"@type":"ImageObject","url":"https://rapkin.com.ua/assets/optimized-img/bunny.png"}},"image":"https://rapkin.com.ua/assets/optimized-img/segmentation-title.png","name":"üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥"}</script><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/inconsolata-v18-latin-regular.woff2" crossorigin="true"/><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/literata-v13-cyrillic_latin-italic.woff2" crossorigin="true"/><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/literata-v13-cyrillic_latin-700.woff2" crossorigin="true"/><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/literata-v13-cyrillic_latin-700italic.woff2" crossorigin="true"/><link rel="preload" as="font" type="font/woff2" href="/assets/fonts/literata-v13-cyrillic_latin-regular.woff2" crossorigin="true"/></head><body><div class="top"><header role="banner"><a class="logo" href="/">@rapkin</a><span class="logo-details">Software developer</span><ul class="menu-wrapper"><li><a class="menu-item" href="/resume/">Resume</a></li><li><a class="menu-item" href="/about/">About</a></li></ul></header><main id="swup"><h1 class="page-title">üá∫üá¶ –°–µ–≥–º–µ–Ω—Ç—É—î–º–æ –º—ñ—Å—Ç–∞ –Ω–∞ –∑–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—ñ—Ç–∫—É –¥–æ—Ä—ñ–≥</h1><p><div class="lazyload" style="padding-bottom: 50%" data-bg="url(/assets/optimized-img/segmentation-title.png)" title="–°–µ–≥–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ –º—ñ—Å—Ç–∞ –Ñ–≤—Ä–æ–ø–∏"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/segmentation-title.png"></a></div></p>
<p>–Ü–Ω–∫–æ–ª–∏ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ —è–∫—É—Å—å —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—é –Ω–∞ –Ω–∞–±—ñ—Ä –∑–æ–Ω –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–æ.
–î–ª—è –ø—Ä–∏–∫–ª–∞–¥—É —Å–µ–≥–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –∑–Ω—ñ–º–∫–∏ –∑ —Å—É–ø—É—Ç–Ω–∏–∫–∞.
–ù–∞–¥–∞–ª—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü—ñ –¥–∞–Ω—ñ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–µ–π—Ä–æ–Ω–Ω–∏—Ö –º–µ—Ä–µ–∂, —â–æ –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–æ–≤–∏—Ö –∑–Ω—ñ–º–∫—ñ–≤, –∞–±–æ –∂ –∑–Ω—ñ–º–∫—ñ–≤ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ–π, —â–æ –º–∞—é—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—î –æ—Ö–æ–ø–ª–µ–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.
(–í —Ü—å–æ–º—É –±–ª–æ–∑—ñ –≤–∂–µ —Ä–æ–±–∏–≤—Å—è –æ–≥–ª—è–¥ –ø—ñ–¥—Ö–æ–¥—É –ø–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–µ—Ä–∏—Ç–æ—Ä—ñ–π).</p>
<h2 id="—â–æ-–Ω–∞–º-–ø–æ—Ç—Ä—ñ–±–Ω–æ-–¥–ª—è-—Ü—å–æ–≥–æ">–©–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —Ü—å–æ–≥–æ?</h2>
<p>–Ø–∫—â–æ –∫–æ—Ä–æ—Ç–∫–æ —Ç–æ Python (Cython), Shapely, OSM/Overpass —Ç–∞ Aspectum —â–æ–± —Ä–æ–±–∏—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é.
–ê —Ç–µ–ø–µ—Ä –ø–æ –∫–æ–∂–Ω–æ–º—É –ø—É–Ω–∫—Ç—É:</p>
<ul>
<li><p><strong>Python</strong> ‚Äî –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ —ñ–Ω—à–æ—é –º–æ–≤–æ—é –∑—Ä–æ–±–∏—Ç–∏ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–µ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤—à–∏ JavaScript —Ç–∞ Turf.js), —Ç–∞ –≤ –¥–µ—è–∫–∏—Ö –º—ñ—Å—Ü—è—Ö –Ω–∞ Python —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —â–æ—Å—å –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –±–µ–∑ –æ—Å–æ–±–ª–∏–≤–∏—Ö –∑—É—Å–∏–ª—å. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Cython –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –∫–æ–¥—É –Ω–∞–ø–∏—Å–∞–Ω–æ–≥–æ –Ω–∞ python –≤ –Ω–∞—Ç–∏–≤–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è.</p>
</li>
<li><p><strong>Shapely</strong> ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –≥–µ–æ–º–µ—Ç—Ä—ñ—î—é.</p>
</li>
<li><p><strong>Geopandas</strong> ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞—Ç–∞—Å–µ—Ç–∞–º–∏ shape-—Ñ–∞–π–ª—ñ–≤.</p>
</li>
<li><p><strong>OSM (OpenStreetMap)</strong> ‚Äî –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ä–µ—Å—É—Ä—Å, –¥–µ —ñ –±—É–¥–µ –≤–∑—è—Ç–æ –≤—Å—é –Ω–µ–æ–±—Ö—ñ–¥–Ω—É –≥–µ–æ–º–µ—Ç—Ä—ñ—é.</p>
</li>
<li><p><strong>Overpass</strong> ‚Äî API —â–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏, —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —á–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∑ OSM.</p>
</li>
<li><p><strong>Osm2geojson</strong> ‚Äî –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö OSM (—Ç–∞ Overpass) –≤ –≥–µ–æ–º–µ—Ç—Ä—ñ—é. –ë—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó <a href="https://github.com/aspectumapp/osm2geojson" target="_blank" rel="noopener" >aspectumapp/osm2geojson</a></p>
</li>
<li><p><strong>Land polygons</strong> ‚Äî –¥–∞—Ç–∞—Å–µ—Ç –±–µ—Ä–µ–≥–æ–≤–æ—ó –ª—ñ–Ω—ñ—ó <a href="https://osmdata.openstreetmap.de/data/land-polygons.html" target="_blank" rel="noopener" >osmdata/land-polygons</a></p>
</li>
<li><p><strong>Aspectum</strong> ‚Äî —Å–µ—Ä–≤—ñ—Å –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –ú–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å —ñ geojson.io, –∞–ª–µ –ø—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≥–µ–æ–º–µ—Ç—Ä—ñ—é –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é. –ß–∞—Å—Ç–æ –º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º QGIS. –°—Ç–æ—Ä—ñ–Ω–∫–∞ —Å–µ—Ä–≤—ñ—Å—É <a href="https://aspectum.com" target="_blank" rel="noopener" >aspectum.com</a></p>
</li>
</ul>
<h2 id="—â–æ-–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ-–º–∏-—Ö–æ—á–µ–º–æ-–æ—Ç—Ä–∏–º–∞—Ç–∏">–©–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –º–∏ —Ö–æ—á–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏?</h2>
<p>GeoJson —Ñ–∞–π–ª, –≤ —è–∫–æ–º—É –º—ñ—Å—Ç—è—Ç—å—Å—è –Ω–∞–±—ñ—Ä –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ –ø–µ–≤–Ω–∏—Ö –∑–æ–Ω (–∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –∑–∞ –Ω–∞–±–æ—Ä–æ–º –ø—Ä–∞–≤–∏–ª).
–ó–æ–Ω–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –≤–∏–¥—ñ–ª–µ–Ω—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—ñ—Ç–∫–∏ –¥–æ—Ä—ñ–≥, –∑–∞–ª—ñ–∑–Ω–∏—á–Ω–∏—Ö —à–ª—è—Ö—ñ–≤, –≤–æ–¥–Ω–∏—Ö –æ–±&#39;—î–∫—Ç—ñ–≤.
–ü—Ä–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ü—ñ –∑–æ–Ω–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤—à–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ –∑ OSM (—Ç–µ–≥–∏ —è–∫—ñ –ø–æ–∑–Ω–∞—á–∞—é—Ç—å —Ç–∏–ø –±—É–¥—ñ–≤–ª—ñ, –∑–µ–º–µ–ª—å–Ω–æ—ó –¥—ñ–ª—è–Ω–∫–∏ —ñ —Ç.–¥.).</p>
<h2 id="—è–∫–∏–π-–∞–ª–≥–æ—Ä–∏—Ç–º-–≤–∏–∫–æ–Ω–∞–Ω–Ω—è-—Ç–∞–∫–æ–≥–æ-–∑–∞–≤–¥–∞–Ω–Ω—è">–Ø–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞–∫–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è?</h2>
<ul>
<li><p>–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≥–µ–æ–º–µ—Ç—Ä—ñ—é coastline (—Ü–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –ø–æ–±—É–¥–æ–≤–∏ –∑–æ–Ω –º—ñ—Å—Ç —è–∫—ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –±—ñ–ª—è –æ–∫–µ–∞–Ω—É).</p>
</li>
<li><p>–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –º–µ–∂—É –º—ñ—Å—Ç–∞ –∑ OSM —ñ —Ñ–æ—Ä–º—É—î–º–æ –∑ –Ω–µ—ó –ø–æ–ª—ñ–≥–æ–Ω (–∞–±–æ –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –≤ –∑–∞–≥–∞–ª—å–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É).</p>
</li>
<li><p>–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–æ—Ä–æ–≥–∏, –∑–∞–ª—ñ–∑–Ω–∏—á–Ω—ñ —à–ª—è—Ö–∏, –≤–æ–¥–Ω—ñ –æ–±&#39;—î–∫—Ç–∏ —ñ —Ñ–æ—Ä–º—É—î–º–æ –∑ –Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –≥–µ–æ–º–µ—Ç—Ä—ñ—é (–Ω–∞–≤–∫–æ–ª–æ –ª—ñ–Ω—ñ–π –±—É–¥—É—î–º–æ –±—É—Ñ–µ—Ä–∏, –ø–æ–ª—ñ–≥–æ–Ω–∏ –∑–∞–ª–∏—à–∞—î–º–æ —É –≤–∏–≥–ª—è–¥—ñ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤).</p>
</li>
<li><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω—à–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –∑ OSM, —è–∫–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∞ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (—Ü–µ —Ç–µ–∂ –ø–æ–ª—ñ–≥–æ–Ω–∏).</p>
</li>
<li><p>–ü—Ä–æ–µ–∫—Ç—É—î–º–æ –≤—Å—é –≥–µ–æ–º–µ—Ç—Ä—ñ—é –≤ –ø—Ä—è–º–æ–∫—É—Ç–Ω—É —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∞–±–∏ –ø–æ–∑–±—É—Ç–∏—Å—å —Å–ø–æ—Ç–≤–æ—Ä–µ–Ω—å –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –≥–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π.</p>
</li>
<li><p>–§–æ—Ä–º—É—î–º–æ –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –≤–∏—Ä–∞—Ö—É–≤–∞–Ω–æ—ó –æ–±&#39;—î–¥–Ω–∞–Ω–æ—ó –∑–æ–Ω–∏ –¥–æ—Ä—ñ–≥.</p>
</li>
<li><p>–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ —Ñ–æ—Ä–º—É—î–º–æ –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –≤–æ–¥–Ω–∏—Ö –æ–±&#39;—î–∫—Ç—ñ–≤.</p>
</li>
<li><p>–í—ñ–¥ –º–µ–∂—ñ –º—ñ—Å—Ç–∞ –≤—ñ–¥–Ω—ñ–º–∞—î–º–æ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω—ñ –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω–∏ –¥–æ—Ä—ñ–≥ —Ç–∞ –≤–æ–¥–Ω–∏—Ö –æ–±&#39;—î–∫—Ç—ñ–≤, —â–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –¥–∞—Å—Ç—å –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –Ω–µ—Ä–æ–∑–º—ñ—á–µ–Ω–∏—Ö –∑–æ–Ω.</p>
</li>
<li><p>–ö–ª–∞—Å–∏—Ñ—ñ–∫—É—î–º–æ –∫–æ–∂–Ω—É –∑–æ–Ω—É –∑–∞ –ø–µ–≤–Ω–∏–º –Ω–∞–±–æ—Ä–æ–º –ø—Ä–∞–≤–∏–ª, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –∑–Ω–∞—Ö–æ–¥—è—á–∏ —Å—É–º—É –ø–µ—Ä–µ—Å—ñ—á–µ–Ω—å –∑ —ñ–Ω—à–∏–º–∏ –æ–±&#39;—î–∫—Ç–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ (–±—É–¥–∏–Ω–∫–∞–º–∏, –ø–æ–ª—è–º–∏ —ñ —Ç.–¥.).</p>
</li>
<li><p>–ü—Ä–æ–µ–∫—Ç—É—î–º–æ –Ω–∞–∑–∞–¥ —É –ø–æ–ª—è—Ä–Ω—É —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.</p>
</li>
<li><p>–ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏.</p>
</li>
</ul>
<p>–ù–∞ —Ü—å–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º –º–æ–∂–Ω–∞ –±—É–ª–æ –± —ñ –∑–∞–≤–µ—Ä—à–∏—Ç–∏, –∞–ª–µ —á–µ—Ä–µ–∑ –≤—ñ–∑—É–∞–ª—å–Ω—É –∑–∞—Å–º—ñ—á–µ–Ω—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Ç–∞–∫–æ–≥–æ &quot;–ø—Ä–æ—Å—Ç–æ–≥–æ&quot; –∞–ª–≥–æ—Ä–∏—Ç–º—É, –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó.</p>
<p><div class="lazyload" style="padding-bottom: 63.36559940431869%" data-bg="url(/assets/optimized-img/not-merged.png)" title="–ó–∞–ª—ñ–∑–Ω–∏—á–Ω–∞ —Ä–æ–∑–≤&#39;—è–∑–∫–∞ —É –º—ñ—Å—Ç—ñ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/not-merged.png"></a></div></p>
<p>–¢–æ–º—É –ø–µ—Ä–µ–¥ –≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è–º –∑–æ–Ω–∏ –¥–æ—Ä—ñ–≥ –≤—ñ–¥ –º–µ–∂—ñ –º—ñ—Å—Ç–∞ –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø—É–Ω–∫—Ç:</p>
<ul>
<li>–û–±&#39;—î–¥–Ω–∞–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö —Ç–∞ –±–ª–∏–∑—å–∫–æ —Ä–æ–∑–º—ñ—â–µ–Ω–∏—Ö –¥–æ—Ä—ñ–≥.</li>
</ul>
<p>–ê –ø–µ—Ä–µ–¥ –ø—É–Ω–∫—Ç–æ–º –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–æ–¥–∞–º–æ —â–µ –æ–¥–∏–Ω –ø—É–Ω–∫—Ç:</p>
<ul>
<li>–ó–≥–ª–∞–¥–∂–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö –Ω–µ—Ä–æ–∑–º—ñ—á–µ–Ω–∏—Ö –∑–æ–Ω.</li>
</ul>
<p>–í–∞—Ä—Ç–æ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ –≤ –¥–µ—è–∫–∏—Ö –º—ñ—Å—Ü—è—Ö –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –æ–±–æ–≤&#39;—è–∑–∫–æ–≤–∏–π —ñ —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —è–∫—ñ—Å—å –∑–∞–≤–¥–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –∞–±–æ —Ä–æ–±–æ—Ç–∞ –∑ –∫–æ–∂–Ω–∏–º –∫–ª–∞—Å–æ–º –≥–µ–æ–º–µ—Ç—Ä—ñ—ó).</p>
<p>–¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–∏ –∫–æ–¥—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É.</p>
<h2 id="–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è-–¥–∞–Ω–∏—Ö-–∑-osm">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ OSM</h2>
<p>–ù–µ –∑–º—ñ–≥ –∑–Ω–∞–π—Ç–∏ —Ö–æ—Ä–æ—à–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∞–±–∏ –≤—ñ–¥–ø–∞—Ä—Å–∏—Ç–∏ –¥–∞–Ω—ñ OSM (—è–∫—â–æ —è –ø–æ–≥–∞–Ω–æ —à—É–∫–∞–≤, —Ç–æ –ø–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Ç–∞–∫–æ—é –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö), —Ç–æ–º—É —â–æ–± —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—É –≥–µ–æ–º–µ—Ç—Ä—ñ—é —è –Ω–∞–ø–∏—Å–∞–≤ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É <a href="https://github.com/aspectumapp/osm2geojson" target="_blank" rel="noopener" >osm2geojson</a>, —è–∫–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î OSM/Overpass XML –≤ –≥–µ–æ–º–µ—Ç—Ä—ñ—é Shapely –∞–±–æ GeoJSON.
–ó–≤–∏—á–∞–π–Ω–æ, –º–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é GDAL, –∞–ª–µ –ø—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–Ω–∞–¥—Ç–æ —Å–∫–ª–∞–¥–Ω–∏–π.</p>
<p>–û—Ç–æ–∂ –æ—Ç—Ä–∏–º–∞—Ç–∏ –º–µ–∂—É –º—ñ—Å—Ç–∞ –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–∏–º –∑–∞–ø–∏—Ç–æ–º –¥–æ API Overpass:</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_city_border</span>(<span class="hljs-params">city_id</span>):</span>
  data = overpass_call(<span class="hljs-string">f&quot;&quot;&quot;
    rel(<span class="hljs-subst">{city_id}</span>);
    out geom;
  &quot;&quot;&quot;</span>) <span class="hljs-comment"># returns xml-string</span>
  data = xml2geojson(data)

  <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> data[<span class="hljs-string">&#x27;features&#x27;</span>]:
    <span class="hljs-keyword">if</span> f[<span class="hljs-string">&#x27;properties&#x27;</span>][<span class="hljs-string">&#x27;tags&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;boundary&#x27;</span>:
      <span class="hljs-keyword">return</span> f
  <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></code></pre>
<p>–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–±–æ—Ä—É –¥–æ—Ä—ñ–≥ –∑–∞–ø–∏—Ç —É–∂–µ —Å–∫–ª–∞–¥–Ω—ñ—à–∏–π:</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_roads</span>(<span class="hljs-params">minlat, minlon, maxlat, maxlon</span>):</span>
  bb = <span class="hljs-string">f&quot;(<span class="hljs-subst">{minlat}</span>, <span class="hljs-subst">{minlon}</span>, <span class="hljs-subst">{maxlat}</span>, <span class="hljs-subst">{maxlon}</span>)&quot;</span>
  data = cached_overpass_call(<span class="hljs-string">f&quot;&quot;&quot;
    way[highway~&quot;^motorway$|^trunk$|^primary$|^secondary$|^tertiary$|^residential<code class="language-python">def get_roads(minlat, minlon, maxlat, maxlon):
  bb = f&quot;({minlat}, {minlon}, {maxlat}, {maxlon})&quot;
  data = cached_overpass_call(f&quot;&quot;&quot;
    way[highway~&quot;^motorway$|^trunk$|^primary$|^secondary$|^tertiary$|^residential$&quot;]{bb};
    out geom;
  &quot;&quot;&quot;)
  return xml2geojson(data)[&#39;features&#39;]</code>quot;]<span class="hljs-subst">{bb}</span>;
    out geom;
  &quot;&quot;&quot;</span>)
  <span class="hljs-keyword">return</span> xml2geojson(data)[<span class="hljs-string">&#x27;features&#x27;</span>]</code></pre>
<p>–í–æ–¥–Ω—ñ –æ–±‚Äô—î–∫—Ç–∏ —è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥–æ—Å–∏—Ç—å –≤–µ–ª–∏–∫–∏–º –∑–∞–ø–∏—Ç–æ–º, –∞–¥–∂–µ —Ç–∞–º –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è —è–∫ –ª—ñ–Ω—ñ–π–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è —Ç–∞–∫ —ñ –ø–æ–ª—ñ–≥–æ–Ω–∞–ª—å–Ω–∞.</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_water_zones</span>(<span class="hljs-params">minlat, minlon, maxlat, maxlon</span>):</span>
  bb = <span class="hljs-string">f&quot;(<span class="hljs-subst">{minlat}</span>, <span class="hljs-subst">{minlon}</span>, <span class="hljs-subst">{maxlat}</span>, <span class="hljs-subst">{maxlon}</span>)&quot;</span>
  data = cached_overpass_call(<span class="hljs-string">f&quot;&quot;&quot;
    (
      way[waterway~&quot;^river$|^stream$|^riverbank<code class="language-python">def get_water_zones(minlat, minlon, maxlat, maxlon):
  bb = f&quot;({minlat}, {minlon}, {maxlat}, {maxlon})&quot;
  data = cached_overpass_call(f&quot;&quot;&quot;
    (
      way[waterway~&quot;^river$|^stream$|^riverbank$&quot;]{bb};
      way[landuse=basin]{bb};
      way[natural=water]{bb};
      way[water]{bb};
      rel[landuse=basin]{bb};
      rel[natural=water]{bb};
      rel[water]{bb};
      rel[waterway=riverbank]{bb};
      &lt;;
    );
    out geom;
  &quot;&quot;&quot;)
  return xml2geojson(data)[&#39;features&#39;]</code>quot;]<span class="hljs-subst">{bb}</span>;
      way[landuse=basin]<span class="hljs-subst">{bb}</span>;
      way[natural=water]<span class="hljs-subst">{bb}</span>;
      way[water]<span class="hljs-subst">{bb}</span>;
      rel[landuse=basin]<span class="hljs-subst">{bb}</span>;
      rel[natural=water]<span class="hljs-subst">{bb}</span>;
      rel[water]<span class="hljs-subst">{bb}</span>;
      rel[waterway=riverbank]<span class="hljs-subst">{bb}</span>;
      &lt;;
    );
    out geom;
  &quot;&quot;&quot;</span>)
  <span class="hljs-keyword">return</span> xml2geojson(data)[<span class="hljs-string">&#x27;features&#x27;</span>]</code></pre>
<p>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –±–µ—Ä–µ–≥–æ–≤—É –ª—ñ–Ω—ñ—é –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Ä—É—á–Ω—É (–∞–¥–∂–µ —Ü–µ –æ–¥–∏–Ω –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –≤—Å—ñ—î—ó –ø–ª–∞–Ω–µ—Ç–∏), –∞–ª–µ –∫–æ—Ä–∏—Å–Ω–æ –º–∞—Ç–∏ –¥–ª—è —Ü—å–æ–≥–æ –∫–æ–¥, —è–∫–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ç–∞ –∫–µ—à—É—î —Ü–µ–π –¥–∞—Ç–∞—Å–µ—Ç, –∞–¥–∂–µ –≤—ñ–Ω –º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—å.
–ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞—Ç–∞—Å–µ—Ç—É, –π–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–∑–∞—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—é:</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_coastline</span>():</span>
  print(<span class="hljs-string">&#x27;Loading coastline to memory ...&#x27;</span>)
  coastline_zip = get_coastline_file() <span class="hljs-comment"># returns abs path to zip file with dataset</span>
  coastline_dir = coastline_zip.replace(<span class="hljs-string">&#x27;.zip&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)
  coastline_file = os.path.join(coastline_dir, <span class="hljs-string">&#x27;land_polygons.shp&#x27;</span>)

  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(coastline_file):
    r = zipfile.ZipFile(coastline_zip, <span class="hljs-string">&#x27;r&#x27;</span>)
    r.extractall(config.CACHE_DIR)
    r.close()

  data = geopandas.read_file(coastline_file)
  print(<span class="hljs-string">&#x27;Coastline loaded!&#x27;</span>)
  <span class="hljs-keyword">return</span> data</code></pre>
<h2 id="—Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è-–ø–æ—á–∞—Ç–∫–æ–≤–æ—ó-–≥–µ–æ–º–µ—Ç—Ä—ñ—ó">–§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó</h2>
<p>–Ø–∫ –±—É–ª–æ —Å–∫–∞–∑–∞–Ω–æ —Ä–∞–Ω—ñ—à–µ, —Ä–æ–±–æ—Ç–∞ –∑ –ª—ñ–Ω—ñ–π–Ω–æ—é —Ç–∞ –ø–æ–ª—ñ–≥–æ–Ω–∞–ª—å–Ω–æ—é –≥–µ–æ–º–µ—Ç—Ä—ñ—è–º–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è ‚Äî –∞–¥–∂–µ –ø–æ–ª—ñ–≥–æ–Ω–∏ –∑–∞–π–º–∞—é—Ç—å –ø–µ–≤–Ω—É –ø–ª–æ—â—É, –∞ –æ—Ç –¥–ª—è –ª—ñ–Ω—ñ–π–Ω–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—é —Ü—é –ø–ª–æ—â—É –ø–æ—Ç—Ä—ñ–±–Ω–æ —è–∫–æ—Å—å –ø–æ–±—É–¥—É–≤–∞—Ç–∏ ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ–Ω—ñ—é –Ω–∞ –ø–æ–ª—ñ–≥–æ–Ω –ø–µ–≤–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É, —è–∫–∏–π –±–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ —Ä–æ–∑–º—ñ—Ä–∞–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±‚Äô—î–∫—Ç—É.
–ê–±–∏ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—ó ‚Äî –≥—Ä—É–±–æ –∫–∞–∂—É—á–∏ —Ü–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –ª—ñ–Ω—ñ—ó.
–í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Shapely –±—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –ø–æ —Ä–æ–±–æ—Ç—ñ —Ü—å–æ–≥–æ –º–µ—Ç–æ–¥—É <a href="https://shapely.readthedocs.io/en/stable/manual.html#object.buffer" target="_blank" rel="noopener" >shapely/object.buffer</a>.</p>
<p>–ó –ø—ñ–¥–±–æ—Ä–æ–º —Ä–æ–∑–º—ñ—Ä—É —Ü—å–æ–≥–æ –±—É—Ñ–µ—Ä—É —Ç–µ–∂ –≤—Å–µ –¥–æ–≤–æ–ª—ñ –ø—Ä–æ—Å—Ç–æ ‚Äî –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≤–∏–¥—ñ–≤ –¥–æ—Ä—ñ–≥ –≤ OSM —î —Å–≤–æ—ó —Ç–µ–≥–∏ —ñ –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —è–∫ —ó—Ö –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –¥–æ—Ä—ñ–≥ –≤ –£–∫—Ä–∞—ó–Ω—ñ –º–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é –∑ <a href="https://wiki.openstreetmap.org/wiki/Uk:%D0%92%D1%96%D0%BA%D1%96%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B0/%D0%9A%D0%BB%D0%B0%D1%81%D0%B8%D1%84%D1%96%D0%BA%D0%B0%D1%86%D1%96%D1%8F_%D0%B4%D0%BE%D1%80%D1%96%D0%B3" target="_blank" rel="noopener" >–≤—ñ–∫—ñ OSM</a> (–¥–ª—è —ñ–Ω—à–∏—Ö –∫—Ä–∞—ó–Ω —Ç–µ–∂ —ñ—Å–Ω—É—é—Ç—å –ø–æ–¥—ñ–±–Ω—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó).
–ê —Å–∞–º—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É –¥–æ—Ä–æ–∂–Ω—å–æ—ó —Å–º—É–≥–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ –¥–µ—Ä–∂–∞–≤–Ω–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö (–¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –∫—Ä–∞—ó–Ω –∑–Ω–∞—á–µ–Ω–Ω—è —á–∞—Å—Ç–æ –æ–¥–Ω–∞–∫–æ–≤—ñ).</p>
<p>–î–ª—è –ø–æ–±—É–¥–æ–≤–∏ –±—É—Ñ–µ—Ä—ñ–≤ —Å–ª—É–≥—É—î —Ñ—É–Ω–∫—Ü—ñ—è build_buffer_on_lines, —è–∫–∞ –≤–∏–∫–æ–Ω—É—î –ø–æ–±—É–¥–æ–≤—É –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞.
–¶–µ–π –≤–∏–¥ –±—É—Ñ–µ—Ä—É –Ω–∞–π–∫—Ä–∞—â–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –Ω–∞—à–æ–≥–æ –≤–∏–ø–∞–¥–∫—É (–ø–æ —è–∫–æ—Å—Ç—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ–±—á–∏—Å–ª–µ–Ω—å).</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_buffer_on_lines</span>(<span class="hljs-params">lines, b_size</span>):</span>
  buffers = []
  <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
    b = line.buffer(b_size, cap_style=<span class="hljs-number">3</span>, join_style=<span class="hljs-number">2</span>, mitre_limit=<span class="hljs-number">1</span>)
    buffers.append(b)
  <span class="hljs-keyword">return</span> array_to_multipolygon(buffers)</code></pre>
<p>–ü—Ä–∏–∫–ª–∞–¥ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è geojson –≤ –≥–µ–æ–º–µ—Ç—Ä—ñ—é shapely –Ω–∞–π–∫—Ä–∞—â–µ –ø—Ä–æ—ñ–ª—é—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—ñ –∑–æ–Ω –≤–æ–¥–Ω–æ—ó —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó:</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert_water_features_to_zones</span>(<span class="hljs-params">geoms</span>):</span>
  water_zones = []
  lines = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> geoms:
    shape = geometry.shape(item[<span class="hljs-string">&#x27;geometry&#x27;</span>])
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(shape, geometry.LineString) <span class="hljs-keyword">or</span> <span class="hljs-built_in">isinstance</span>(shape, geometry.MultiLineString):
      lines.append(shape)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(shape, geometry.Polygon) <span class="hljs-keyword">or</span> <span class="hljs-built_in">isinstance</span>(shape, geometry.MultiPolygon):
      water_zones.append(shape)

  rivers = build_buffer_on_lines(lines, buffer_sizes[<span class="hljs-string">&#x27;river&#x27;</span>])
  water_zones.append(rivers)
  <span class="hljs-keyword">return</span> ops.cascaded_union(water_zones)</code></pre>
<p>–ù–∞ –∂–∞–ª—å, –ø—Ä–æ—Ü–µ—Å –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó OSM –Ω–µ –≤–¥–∞—Å—Ç—å—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ–º—ñ—Å—Ç–∏—Ç–∏ –≤ —Ü—é —Å—Ç–∞—Ç—Ç—é (–Ω–∞—Å–ø—Ä–∞–≤–¥—ñ —Ü–µ –º–æ–∂–Ω–∞ –≤–∏–¥—ñ–ª–∏—Ç–∏ –≤ –æ–∫—Ä–µ–º—É –≤–µ–ª–∏—á–µ–∑–Ω—É —Å—Ç–∞—Ç—Ç—é), –∞–ª–µ –≤ –∫—ñ–ª—å–∫–æ—Ö —Å–ª–æ–≤–∞—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—î—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –∑ OSM —Ç–∞ —Ä–æ–∑–±–∏—Ç—Ç—è –∑–∞ –ø–µ–≤–Ω–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –Ω–∞ —Ü—ñ–ª—å–æ–≤–∏–π –Ω–∞–±—ñ—Ä –∫–ª–∞—Å—ñ–≤.</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_geometry</span>(<span class="hljs-params">minlat, minlon, maxlat, maxlon</span>):</span>
  query = <span class="hljs-string">f&quot;(node(<span class="hljs-subst">{minlat}</span>, <span class="hljs-subst">{minlon}</span>, <span class="hljs-subst">{maxlat}</span>, <span class="hljs-subst">{maxlon}</span>);&lt;;); out geom;&quot;</span><span class="hljs-string">&quot;&quot;</span>
  data = cached_overpass_call(query)

  features = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> xml2geojson(data)[<span class="hljs-string">&#x27;features&#x27;</span>]:
    <span class="hljs-keyword">if</span> item[<span class="hljs-string">&#x27;geometry&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;Polygon&#x27;</span>, <span class="hljs-string">&#x27;MultiPolygon&#x27;</span>]:
      cls = detect_class(item) <span class="hljs-comment"># here some magic</span>
    <span class="hljs-keyword">if</span> cls <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
      <span class="hljs-keyword">continue</span>
    item[<span class="hljs-string">&#x27;properties&#x27;</span>][<span class="hljs-string">&#x27;class&#x27;</span>] = cls
    features.append(item)
  <span class="hljs-keyword">return</span> features</code></pre>
<p>–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ —Ü–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –º–∏ –æ—Ç—Ä–∏–º—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –Ω–∞–±–æ—Ä–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó (–Ω–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤):</p>
<ul>
<li>–º–µ–∂–∞ –º—ñ—Å—Ç–∞ (border)</li>
</ul>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/border.png)" title="–ú–µ–∂–∞ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/border.png"></a></div></p>
<ul>
<li>–º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –∑–≤–∏—á–∞–π–Ω–∏—Ö –¥–æ—Ä–æ–∂–Ω—ñ—Ö —à–ª—è—Ö—ñ–≤ (roads)</li>
</ul>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/roads-kiev.png)" title="–î–æ—Ä–æ–≥–∏ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/roads-kiev.png"></a></div></p>
<ul>
<li>–º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –∑–∞–ª—ñ–∑–Ω–∏—á–Ω–∏—Ö —à–ª—è—Ö—ñ–≤ (railways)</li>
</ul>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/railways-kiev.png)" title="–ó–∞–ª—ñ–∑–Ω–∏—á–Ω—ñ —à–ª—è—Ö–∏ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/railways-kiev.png"></a></div></p>
<ul>
<li>–º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω –≤–æ–¥–Ω–∏—Ö –æ–±‚Äô—î–∫—Ç—ñ–≤ (water_zones)</li>
</ul>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/water-kiev.png)" title="–í–æ–¥–Ω—ñ –æ–±&#39;—î–∫—Ç–∏ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/water-kiev.png"></a></div></p>
<ul>
<li>–≤—Å—è —ñ–Ω—à–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è, –ø–æ —è–∫—ñ–π –±—É–¥–µ –ø—Ä–æ–≤–æ–¥–∏—Ç–∏—Å—å –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è, –∑–≥—Ä—É–ø–æ–≤–∞–Ω–∞ –∑–∞ —Ü—ñ–ª—å–æ–≤–∏–º –Ω–∞–±–æ—Ä–æ–º –∫–ª–∞—Å—ñ–≤ (all_geometry_by_class)</li>
</ul>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/classified-geom.png)" title="–ö–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/classified-geom.png"></a></div></p>
<h2 id="–ø—Ä–æ—Å—Ç–∏–π-–∞–ª–≥–æ—Ä–∏—Ç–º">‚Äú–ü—Ä–æ—Å—Ç–∏–π‚Äù –∞–ª–≥–æ—Ä–∏—Ç–º</h2>
<p>–î–ª—è —Ç–æ–≥–æ —â–æ–± –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –∑–≤–∏—á–∞–π–Ω—É –∫–∞—Ä—Ç—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞ –º–µ–∂—É –º—ñ—Å—Ç–∞ –Ω–∞–∫–ª–∞—Å—Ç–∏ –≤—Å—é —ñ–Ω—à—É –≥–µ–æ–º–µ—Ç—Ä—ñ—é –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤.
–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—ñ –∫–æ–∂–Ω–æ–≥–æ –∫–ª–∞—Å—É –Ω–µ –∑–æ–≤—Å—ñ–º –æ—á–µ–≤–∏–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –≤–æ–¥–Ω—ñ –æ–±‚Äô—î–∫—Ç–∏ –º–∞—é—Ç—å –Ω–∞–π–Ω–∏–∂—á–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç, –±–æ –∑–∞–∑–≤–∏—á–∞–π –¥–æ—Ä–æ–∂–Ω—ñ —Ç–∞ –∑–∞–ª—ñ–∑–Ω–∏—á–Ω—ñ —à–ª—è—Ö–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –Ω–∞–¥ —Ä—ñ—á–∫–∞–º–∏ —ñ —Ç.–¥..</p>
<p>–ê –æ—Ç –∑ –¥–æ—Ä–æ–≥–∞–º–∏ —Ç–∞ –∑–∞–ª—ñ–∑–Ω–∏—Ü–µ—é –≤—Å–µ —Ç—Ä–æ—Ö–∏ —Å–∫–ª–∞–¥–Ω—ñ—à–µ, –±–æ –¥–æ—Ä–æ–∂–Ω—ñ –º–æ—Å—Ç–∏ –º–æ–∂—É—Ç—å –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –Ω–∞–¥ –∑–∞–ª—ñ–∑–Ω–∏—á–Ω–∏–º–∏ —à–ª—è—Ö–∞–º–∏, —Ç–∞–∫ —ñ –Ω–∞–≤–ø–∞–∫–∏ ‚Äî –∑–∞–ª—ñ–∑–Ω–∏—á–Ω—ñ –º–æ—Å—Ç–∏ –Ω–∞–¥ –¥–æ—Ä–æ–∂–Ω—ñ–º–∏ —à–ª—è—Ö–∞–º–∏.
–ê–ª–µ –≤—Å–µ –∂ –∫—Ä–∞—â–µ –≤–∏—è–≤–∏–ª–æ—Å—å –Ω–∞–¥–∞–≤–∞—Ç–∏ –¥–æ—Ä–æ–≥–∞–º –≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–æ–∑–º—ñ—á–µ–Ω–æ—ó —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó –±—É–¥–µ –±—ñ–ª—å—à–∞).
–Ñ —ñ –±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω–∞ —Å—Ö–µ–º–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –æ—Ç—Ä–∏–º–∞–Ω–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –Ω–∞ —à–∞—Ä–∏, —è–∫–∞ –æ–ø–∏—Å–∞–Ω–∞ —Ç—É—Ç <a href="https://wiki.openstreetmap.org/wiki/Key:layer" target="_blank" rel="noopener" >wiki.osm/Key:layer</a>.
–ú—ñ–Ω—É—Å–æ–º —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É —É –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É ‚Äî –∑–Ω–∞—á–Ω–∏–π —Ä—ñ—Å—Ç –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ–±—á–∏—Å–ª–µ–Ω—å.</p>
<p><div class="lazyload" style="padding-bottom: 100%" data-bg="url(/assets/optimized-img/layers.png)" title="–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–∫–ª–∞–¥–∞–Ω–Ω—è —à–∞—Ä—ñ–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/layers.png"></a></div></p>
<p>–û–¥–Ω–∏–º –∑ –≤–∞–∂–ª–∏–≤–∏—Ö –µ—Ç–∞–ø—ñ–≤ –≤ –æ–±—Ä–∞—Ö—É–Ω–∫–∞—Ö —î –µ—Ç–∞–ø –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó.
–ù–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏–Ω–∏–∫–∞—î –ø–æ –ø—Ä–∏—á–∏–Ω—ñ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –≤–µ–ª–∏–∫–∏—Ö –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ –¥–æ—Ä—ñ–≥ —Ç–∞ –≤–æ–¥–Ω–∏—Ö –æ–±‚Äô—î–∫—Ç—ñ–≤ (—ñ–Ω–∫–æ–ª–∏ —Å—ñ—Ç–∫–∞ –¥–æ—Ä—ñ–≥ –ø–æ–∫—Ä–∏–≤–∞—î –ª–µ–¥—å –Ω–µ –≤—Å–µ –º—ñ—Å—Ç–æ —ñ —Ñ–æ—Ä–º—É—î –æ–¥–∏–Ω –ø–æ–ª—ñ–≥–æ–Ω).
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞–∫–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–≥–æ —Ä–æ—Å—Ç—É —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ –æ–±—á–∏—Å–ª–µ–Ω—å (–Ω–∞ –≤–µ–ª–∏–∫–∏—Ö –º—ñ—Å—Ç–∞—Ö —Ü–µ –º–æ–∂–µ –∑–∞–π–º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –¥—ñ–±).
–©–æ–± –ø–æ–∑–±—É—Ç–∏—Å—å —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏ –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Ä–æ–∑–±–∏–≤–∞—Ç–∏ –≤–µ–ª–∏–∫—ñ –ø–æ–ª—ñ–≥–æ–Ω–∏ –Ω–∞ –º–µ–Ω—à—ñ. –í–∏–≤—á–∞—é—á–∏ —Ü—é —Ç–µ–º—É —è –Ω–∞—Ç—Ä–∞–ø–∏–≤ –Ω–∞ –∫–æ—Ä–∏—Å–Ω—É <a href="https://snorfalorpagus.net/blog/2016/03/13/splitting-large-polygons-for-faster-intersections/" target="_blank" rel="noopener" >—Å—Ç–∞—Ç—Ç—é</a>, –¥–µ —Ç–µ–∂ –≤–∏—Ä—ñ—à—É–≤–∞–ª–∞—Å—å —Ü—è –ø—Ä–æ–±–ª–µ–º–∞.
–°–∞–º–µ —Ü–µ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–∑–±–∏—Ç—Ç—è —è —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤.</p>
<p>–©–µ –æ–¥–Ω–∞ –≤–∞–∂–ª–∏–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Ü–µ –ø–æ–±—É–¥–æ–≤–∞ —ñ–Ω–¥–µ–∫—Å—É –Ω–∞–¥ –Ω–∞–±–æ—Ä–∞–º–∏ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ (–¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ –ø—Ä–æ —Ü–µ –º–æ–∂–Ω–∞ –ø–æ—á–∏—Ç–∞—Ç–∏ –≤ <a href="https://geoffboeing.com/2016/10/r-tree-spatial-index-python/" target="_blank" rel="noopener" >—Ü—ñ–π —Å—Ç–∞—Ç—Ç—ñ</a>).
–í –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ Shapely –≤–∂–µ –≤–±—É–¥–æ–≤–∞–Ω–∏–π —Ö–æ—Ä–æ—à–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó STRtree (Sort-Tile-Recursive algorithm).
–ö–æ–¥ –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –ø–µ—Ä–µ—Å—ñ—á–µ–Ω–Ω—è —Ç–∞ —Ä—ñ–∑–Ω–∏—Ü—ñ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ —Ç—Ä–æ—Ö–∏ —É—Å–∫–ª–∞–¥–Ω–∏—Ç—å—Å—è (–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –µ—Ç–∞–ø —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó —Ç–∞ –ø–æ—à—É–∫—É –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ —É —ñ–Ω–¥–µ–∫—Å—ñ), –∞–ª–µ –¥–æ—Å–∏—Ç—å –ø—Ä–æ—Å—Ç–æ –≤–∏–¥—ñ–ª–∏—Ç–∏ —Ü—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ –æ–∫—Ä–µ–º—ñ –º–µ—Ç–æ–¥–∏</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimized_intersection</span>(<span class="hljs-params">a, b</span>):</span>
  a_opt = katana(a, split_size)
  b_opt = katana(b, split_size)
  a_tree = STRtree(a_opt)

  parts = []
  <span class="hljs-keyword">for</span> zone <span class="hljs-keyword">in</span> b_opt:
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> a_tree.query(zone):
      intersection =  p.intersection(zone)
      <span class="hljs-keyword">if</span> intersection.area &gt; <span class="hljs-number">0</span>:
        parts.append(intersection)

  <span class="hljs-keyword">return</span> array_to_multipolygon(parts)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimized_difference</span>(<span class="hljs-params">a, b</span>):</span>
  a_opt = katana(a, split_size)
  b_opt = katana(b, split_size)
  b_tree = STRtree(b_opt)

  parts = []
  <span class="hljs-keyword">for</span> zone <span class="hljs-keyword">in</span> a_opt:
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> b_tree.query(zone):
      zone = zone.difference(p)
      parts.append(zone)

  <span class="hljs-keyword">return</span> array_to_multipolygon(parts)</code></pre>
<p>–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –º–æ–∂–Ω–∞ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –¥–æ –ª–æ–≥—ñ–∫–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—É:</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_simple_zones</span>(<span class="hljs-params">border, roads, railways, water_zones</span>):</span>
  roads_in_city = optimized_intersection(roads, border)
  railways_in_city = optimized_intersection(railways, border)
  water_zones_in_city = optimized_intersection(water_zones, border)

  water_zones_fixed = optimized_difference(water_zones_in_city, roads_in_city)
  water_zones_fixed = optimized_difference(water_zones_fixed, railways_in_city)

  city_zones = optimized_difference(border, roads)
  city_zones = optimized_difference(city_zones, railways)
  city_zones = optimized_difference(city_zones, water_zones)

  railways_without_roads = optimized_difference(railways_in_city, roads_in_city)

  features = multipolygon_to_features(roads_in_city, <span class="hljs-string">&#x27;roads&#x27;</span>)
  features += multipolygon_to_features(water_zones_fixed, <span class="hljs-string">&#x27;water&#x27;</span>)
  features += multipolygon_to_features(railways_without_roads, <span class="hljs-string">&#x27;railways&#x27;</span>)
  features += multipolygon_to_features(city_zones)

  <span class="hljs-keyword">return</span> features</code></pre>
<p>–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –º–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –Ω–∞–±—ñ—Ä –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ (–≤ GeoJSON).
–ê–ª–µ –∫—ñ–Ω—Ü–µ–≤–∞ —Ü—ñ–ª—å ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∑–æ–Ω–∏ –º—ñ—Å—Ç–∞, —Ç–æ–º—É –ø–æ–ª—ñ–≥–æ–Ω–∏ —è–∫—ñ —â–µ –Ω–µ –º–∞—é—Ç—å –∫–ª–∞—Å—É –ø–æ—Ç—Ä—ñ–±–Ω–æ —è–∫–æ—Å—å –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ (–∑–æ–Ω–∏ –¥–æ—Ä—ñ–≥, –∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ —Ç–∞ –≤–æ–¥–Ω–∏—Ö –æ–±‚Äô—î–∫—Ç—ñ–≤ –º–∏ –≤–∂–µ –æ—Ç—Ä–∏–º–∞–ª–∏ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –µ—Ç–∞–ø–∞—Ö).</p>
<p>–î–ª—è –ø—Ä–∏–∫–ª–∞–¥—É –º–æ–∂–Ω–∞ –ø—Ä–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ü—ñ –∑–æ–Ω–∏ –ø–æ—Ä–∞—Ö—É–≤–∞–≤—à–∏ –ø–ª–æ—â—É –ø–µ—Ä–µ—Å—ñ—á–µ–Ω–Ω—è –∑ —ñ–Ω—à–∏–º–∏ –ø–æ–ª—ñ–≥–æ–Ω–∞–º–∏ OSM (—è–∫—ñ –¥–æ —Ü—å–æ–≥–æ –±—É–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–º—ñ—á–µ–Ω—ñ –∑–∞ —Ü—ñ–ª—å–æ–≤–∏–º –Ω–∞–±–æ—Ä–æ–º –∫–ª–∞—Å—ñ–≤).</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classify_features</span>(<span class="hljs-params">features, all_geometry_by_class</span>):</span>
  geometry_index = {}
  <span class="hljs-keyword">for</span> cls <span class="hljs-keyword">in</span> all_geometry_by_class:
    geometry_index[cls] = STRtree(all_geometry_by_class[cls])

    <span class="hljs-keyword">for</span> feature <span class="hljs-keyword">in</span> features:
      <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;class&#x27;</span> <span class="hljs-keyword">in</span> f[<span class="hljs-string">&#x27;properties&#x27;</span>]:
        <span class="hljs-keyword">continue</span>

      shape = geometry.shape(feature[<span class="hljs-string">&#x27;geometry&#x27;</span>])
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> shape.is_valid:
        print(<span class="hljs-string">&#x27;Shape is invalid! Try to fix&#x27;</span>)
        shape = polygon_fix(shape)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> shape.is_valid:
          print(<span class="hljs-string">&#x27;Not fixed :(&#x27;</span>, validation.explain_validity(shape))
          <span class="hljs-keyword">continue</span>

      probs = {}
      <span class="hljs-keyword">for</span> cls <span class="hljs-keyword">in</span> geometry_index:
        probs[cls] = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> geometry_index[cls].query(shape):
          <span class="hljs-keyword">if</span> s.is_valid:
            probs[cls] += shape.intersection(s).area

      detected_class = <span class="hljs-string">&#x27;Artificial Surfaces&#x27;</span> <span class="hljs-comment"># default class</span>
      max_area = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> cls <span class="hljs-keyword">in</span> probs:
        <span class="hljs-keyword">if</span> probs[cls] &gt; max_area:
          max_area = probs[cls]
          detected_class = cls

      feature[<span class="hljs-string">&#x27;properties&#x27;</span>] = {
        <span class="hljs-string">&#x27;class&#x27;</span>: detected_class,
        <span class="hljs-string">&#x27;probabilities&#x27;</span>: normalize(probs)
      }
  <span class="hljs-keyword">return</span> features</code></pre>
<p>–¶—ñ–∫–∞–≤–æ—é —á–∞—Å—Ç–∏–Ω–æ—é —Ç—É—Ç —î —Ñ—É–Ω–∫—Ü—ñ—è polygon_fix, —è–∫–∞ —á–∞—Å—Ç–æ –¥–æ–ø–æ–º–∞–≥–∞—î –≤–ø–æ—Ä–∞—Ç–∏—Å—å –∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—é –≥–µ–æ–º–µ—Ç—Ä—ñ—î—é (–Ω–∞ –∂–∞–ª—å, —è –≤–∂–µ –π –Ω–µ –ø–∞–º‚Äô—è—Ç–∞—é –¥–µ –∑–Ω–∞–π—à–æ–≤ –∫–æ–¥ —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó).</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">polygon_fix</span>(<span class="hljs-params">polygon</span>):</span>
  be = polygon.exterior
  mls = be.intersection(be)
  polygons = ops.polygonize(mls)
  <span class="hljs-keyword">return</span> geometry.MultiPolygon(polygons)</code></pre>
<p>–ù–∞ —Ü—å–æ–º—É –æ—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—É –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è, –∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω—É –≥–µ–æ–º–µ—Ç—Ä—ñ—é –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ —Ñ–∞–π–ª –∞–±–∏ –¥–µ—Å—å –≤—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏.</p>
<p>–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–ª—è –º—ñ—Å—Ç–∞ –ö–∏—ó–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º QGIS</p>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/kiev-simple.png)" title="–ö–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∑–æ–Ω–∏ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/kiev-simple.png"></a></div></p>
<p>–†–æ–∑–¥–∏–≤–∏—Ç–∏—Å—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—É –≥–µ–æ–º–µ—Ç—Ä—ñ—é –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤—à–∏ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º—É Aspectum:</p>
<iframe title="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –∑ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º–∏ –∑–æ–Ω–∞–º–∏" class="lazyload" data-src="https://aspectum.com/app/maps/embed/dbcc98bb-6bd2-49ee-92d0-26d03297a33b" width="960" height="600" frameborder="0" style="border: 0"></iframe>

<h2 id="–∞–ª–≥–æ—Ä–∏—Ç–º-–∑-–æ–±—î–¥–Ω–∞–Ω–Ω—è–º-–¥–æ—Ä—ñ–≥">–ê–ª–≥–æ—Ä–∏—Ç–º –∑ –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è–º –¥–æ—Ä—ñ–≥</h2>
<p>–¶–µ–π –∞–ª–≥–æ—Ä–∏—Ç–º –º–∞–π–∂–µ –Ω–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ, –≤—ñ–¥–º—ñ–Ω–Ω–∏–π –ª–∏—à–µ –µ—Ç–∞–ø —É—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ –¥–æ—Ä—ñ–≥ (–∑–≤–∏—á–∞–π–Ω–∏—Ö —Ç–∞ –∑–∞–ª—ñ–∑–Ω–∏—á–Ω–∏—Ö).
–ê–±–∏ —Ü—å–æ–≥–æ –¥–æ—Å—è–≥–Ω—É—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–º—ñ—Å—Ç—å –∑–≤–∏—á–∞–π–Ω–æ—ó –ø–æ–±—É–¥–æ–≤–∏ –±—É—Ñ–µ—Ä—ñ–≤ —Ä–æ–±–∏—Ç–∏ –±—É—Ñ–µ—Ä –±—ñ–ª—å—à–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É, –∞ –ø–æ—Ç—ñ–º –æ–ø–µ—Ä–∞—Ü—ñ—î—é –≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –±—É—Ñ–µ—Ä—É –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É, –ø—Ä–∏ —Ü—å–æ–º—É –¥–æ—Ä–æ–≥–∏ —è–∫—ñ –±—É–ª–∏ –ø–æ—Ä—è–¥ —Å—Ç–∞–Ω—É—Ç—å –æ–±‚Äô—î–¥–Ω–∞–Ω–∏–º–∏.</p>
<p><div class="lazyload" style="padding-bottom: 63.36559940431869%" data-bg="url(/assets/img/merge-vis.gif)" title="–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—É –æ–±&#39;—î–¥–Ω–∞–Ω–Ω—è –¥–æ—Ä—ñ–≥"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/merge-vis.gif"></a></div></p>
<p>–ö–æ–¥ —è–∫–∏–π —Ü–µ —Ä–æ–±–∏—Ç—å</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">merge_roads</span>(<span class="hljs-params">polygon</span>):</span>
  area = polygon.buffer(merge_buffer_size, cap_style=<span class="hljs-number">2</span>, join_style=<span class="hljs-number">2</span>, mitre_limit=<span class="hljs-number">1</span>)
  <span class="hljs-keyword">return</span> area.buffer(-merge_buffer_size, cap_style=<span class="hljs-number">2</span>, join_style=<span class="hljs-number">2</span>, mitre_limit=<span class="hljs-number">1</span>)</code></pre>
<p>–†—ñ–∑–Ω–∏—Ü—é –≤ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó, —â–æ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è, –º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏ –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ.</p>
<p><div class="lazyload" style="padding-bottom: 47.45347698334966%" data-bg="url(/assets/optimized-img/kiev-compare-geom.png)" title="–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó —Ç–∞ –ø—ñ—Å–ª—è –æ–±&#39;—î–¥–Ω–∞–Ω–Ω—è"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/kiev-compare-geom.png"></a></div></p>
<p>–ê –ø–æ–≤–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –º—ñ—Å—Ç–∞ –ö–∏—ó–≤:</p>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/kiev-merged.png)" title="–ó–æ–Ω–∏ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤ –∑ –æ–±&#39;—î–¥–Ω–∞–Ω–∏–º–∏ –¥–æ—Ä–æ–≥–∞–º–∏"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/kiev-merged.png"></a></div></p>
<p>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö –º—ñ—Å—Ç –º–æ–∂–Ω–∞ —Ç—É—Ç:</p>
<iframe  title="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –∑ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º–∏ –∑–æ–Ω–∞–º–∏ —Ç–∞ –æ–±'—î–¥–Ω–∞–Ω–∏–º–∏ –¥–æ—Ä–æ–≥–∞–º–∏" class="lazyload" data-src="https://aspectum.com/app/maps/embed/2351cf7d-e975-4a5d-b10a-b6c2776474da" width="960" height="600" frameborder="0" style="border: 0"></iframe>

<h2 id="–∞–ª–≥–æ—Ä–∏—Ç–º-–∑—ñ-–∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è–º-–∑–æ–Ω">–ê–ª–≥–æ—Ä–∏—Ç–º –∑—ñ –∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è–º –∑–æ–Ω</h2>
<p>–î–µ–∫–æ–ª–∏ –≤–∏—Å–æ–∫–µ ‚Äú–∑–∞—Å–º—ñ—á–µ–Ω–Ω—è‚Äù –∫–∞—Ä—Ç–∏ –¥–æ—Ä–æ–≥–∞–º–∏ —î –Ω–µ–±–∞–∂–∞–Ω–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –≤—ñ–∑—É–∞–ª—å–Ω–æ —Ü–µ –ø–æ–≥–∞–Ω–æ —Å–ø—Ä–∏–π–º–∞—î—Ç—å—Å—è).
–î–ª—è —Ü—å–æ–≥–æ –∑–Ω–æ–≤—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é –∑ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º —Ç–∞ –≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è–º –±—É—Ñ–µ—Ä—É ‚Äî –¥–ª—è –∫–æ–∂–Ω–æ—ó –∑–æ–Ω–∏ –º–∏ —Å–ø–µ—Ä—à—É –¥–æ–¥–∞—î–º–æ –±—É—Ñ–µ—Ä, –∞ –ø–æ—Ç—ñ–º –≤—ñ–¥–Ω—ñ–º–∞—î–º–æ.
–ê–ª–µ —á–µ—Ä–µ–∑ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –ª—ñ–Ω—ñ–π –¥–æ—Ä—ñ–≥ (–ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –ª–∏—à–µ —Å–ª—ñ–ø—ñ –¥–æ—Ä–æ–≥–∏) –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ—â–æ —É—Å–∫–ª–∞–¥–Ω–∏—Ç—å—Å—è</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_smoothed_zones</span>(<span class="hljs-params">border, roads, railways, water_zones</span>):</span>
  smooth_city_zones_by_roads = make_smooth_zones(optimized_difference(border, roads))
  other_zones_by_roads = optimized_difference(border, smooth_city_zones_by_roads)
  smoothed_roads = optimized_intersection(roads, other_zones_by_roads)
  roads_in_city = optimized_intersection(smoothed_roads, border)

  smooth_city_zones_by_railways = make_smooth_zones(optimized_difference(border, railways))
  other_zones_by_railways = optimized_difference(border, smooth_city_zones_by_railways)
  smoothed_railways = optimized_intersection(railways, other_zones_by_railways)
  railways_in_city = optimized_difference(smoothed_railways, smoothed_roads)

  water_zones_in_city = optimized_intersection(water_zones, border)
  water_zones_in_city = optimized_difference(water_zones_in_city, roads_in_city)
  water_zones_in_city = optimized_difference(water_zones_in_city, railways_in_city)

  smooth_city_zones = optimized_difference(border, smoothed_roads)
  smooth_city_zones = optimized_difference(smooth_city_zones, smoothed_railways)
  smooth_city_zones = optimized_difference(smooth_city_zones, water_zones)

  features = multipolygon_to_features(roads_in_city, <span class="hljs-string">&#x27;roads&#x27;</span>)
  features += multipolygon_to_features(railways_in_city, <span class="hljs-string">&#x27;railways&#x27;</span>)
  features += multipolygon_to_features(water_zones_in_city, <span class="hljs-string">&#x27;water&#x27;</span>)
  features += multipolygon_to_features(smooth_city_zones)

  <span class="hljs-keyword">return</span> features</code></pre>
<p>–Ø–∫ –ø–æ–º—ñ—Ç–Ω–æ –∑ –∫–æ–¥—É, –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è ‚Äî make_smooth_zones.
–°–∞–º–µ –≤–æ–Ω–∞ —ñ –∑–∞–π–º–∞—î—Ç—å—Å—è –ø–æ–±—É–¥–æ–≤–æ—é –±—É—Ñ–µ—Ä—ñ–≤ —ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó (—ñ–Ω–∫–æ–ª–∏ –∑–æ–Ω–∏ –Ω–∞–∫–ª–∞–¥–∞—é—Ç—å—Å—è –æ–¥–Ω–∞ –Ω–∞ –æ–¥–Ω—É —ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–µ –≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –º—ñ–∂ –ø–æ–ª—ñ–≥–æ–Ω–∞–º–∏ –∑–æ–Ω –∞–±–∏ —É—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –º—É–ª—å—Ç–∏–ø–æ–ª—ñ–≥–æ–Ω)</p>
<pre><code data-lang="python" class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_smooth_zones</span>(<span class="hljs-params">city_zones</span>):</span>
  zones_polygons = []
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(city_zones, geometry.Polygon):
    zones_polygons.append(city_zones)
  <span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">for</span> poly <span class="hljs-keyword">in</span> city_zones.geoms:
      zones_polygons.append(
        poly
        .buffer(merge_buffer_size, cap_style=<span class="hljs-number">3</span>, join_style=<span class="hljs-number">2</span>, mitre_limit=<span class="hljs-number">1</span>)
        .buffer(-merge_buffer_size, cap_style=<span class="hljs-number">2</span>, join_style=<span class="hljs-number">2</span>, mitre_limit=<span class="hljs-number">1</span>)
      )

  zonesTree = STRtree(zones_polygons)
  <span class="hljs-keyword">for</span> idx, zone <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(zones_polygons):
    found = zonesTree.query(zone)
    <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> found:
      <span class="hljs-keyword">if</span> zone.intersects(z):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> z <span class="hljs-keyword">is</span> zone <span class="hljs-keyword">and</span> zone.intersection(z).area &gt; <span class="hljs-number">0</span>:
          zones_polygons[idx] = zone.difference(z.buffer(<span class="hljs-number">0.000001</span>, cap_style=<span class="hljs-number">2</span>, join_style=<span class="hljs-number">2</span>, mitre_limit=<span class="hljs-number">1</span>))

  <span class="hljs-keyword">return</span> geometry.MultiPolygon(zones_polygons)</code></pre>
<p>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è</p>
<p><div class="lazyload" style="padding-bottom: 94.90695396669932%" data-bg="url(/assets/optimized-img/kiev.png)" title="–ó–≥–ª–∞–¥–∂–µ–Ω—ñ –∑–æ–Ω–∏ –º—ñ—Å—Ç–∞ –ö–∏—ó–≤"><a data-no-swup target="_blank" class="download-link" title="Open full image" href="/assets/img/kiev.png"></a></div></p>
<p>–†–æ–∑–¥–∏–≤–∏—Ç–∏—Å—å –º–æ–∂–Ω–∞ —Ç—É—Ç:</p>
<iframe title="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –∑—ñ –∑–≥–ª–∞–¥–∂–µ–Ω–∏–º–∏ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º–∏ –∑–æ–Ω–∞–º–∏" class="lazyload" data-src="https://aspectum.com/app/maps/embed/10da881d-136c-4c53-b83c-b22815a09ba7" width="960" height="600" frameborder="0" style="border: 0"></iframe>

<h2 id="–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è-–≤–∏–∫–æ–Ω–∞–Ω–Ω—è-–∞–ª–≥–æ—Ä–∏—Ç–º—É">–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—É</h2>
<p>–û—Å–∫—ñ–ª—å–∫–∏ —Ü–µ–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤–∏–∫–æ–Ω—É—î —Ä–æ–∑–º—ñ—Ç–∫—É –¥–ª—è –º—ñ—Å—Ç–∞, —Ç–æ –ª–æ–≥—ñ—á–Ω–æ –±—É–¥–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ –¥–µ–∫—ñ–ª—å–∫–æ—Ö –º—ñ—Å—Ç–∞—Ö.
–ê –≤ —Ç–æ–º—É —â–æ–± —Ä–æ–±–∏—Ç–∏ —Ü–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–µ–º–∞ –Ω—ñ—è–∫–æ—ó –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ ‚Äî –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ –±—É–¥–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º—ñ—Å—Ç–∞ –≤ –æ–∫—Ä–µ–º–æ–º—É –ø–æ—Ç–æ—Ü—ñ.</p>
<p>–¢–∞–∫–æ–∂ –≤–µ–ª–∏–∫—É —á–∞—Å—Ç–∏–Ω—É –æ–±—Ä–∞—Ö–æ–≤–∞–Ω–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –º–æ–∂–Ω–∞ –∫–µ—à—É–≤–∞—Ç–∏ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –Ω–∞ –∂–æ—Ä—Å—Ç–∫–∏–π –¥–∏—Å–∫, –∞–ª–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Ç–µ, —â–æ OSM –ø–æ—Å—Ç—ñ–π–Ω–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —ñ –ø—Ä–æ —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ü—å–æ–≥–æ –∫–µ—à—É –∑–∞–±—É–≤–∞—Ç–∏ –Ω–µ —Ç—Ä–µ–±–∞.</p>
<p>–©–µ –æ–¥–Ω–∏–º –º—ñ—Å—Ü–µ–º –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —î —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä Python.
–ó–Ω–∞—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±—á–∏—Å–ª–µ–Ω—å –≤ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ Shapely —ñ —Ç–∞–∫ –≤–∏–Ω–µ—Å–µ–Ω–∞ –≤ –Ω–∞—Ç–∏–≤–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (–æ—Å–Ω–æ–≤–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ –∑ –≥–µ–æ–º–µ—Ç—Ä—ñ—î—é –∑–∞–π–º–∞—î—Ç—å—Å—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ GEOS, —è–∫–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ C++).
–ê–ª–µ –≤ –Ω–∞—à–æ–º—É –∫–æ–¥—ñ —Ç–∞–∫–æ–∂ —î –≤–µ–ª–∏–∫–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±—Ä–∞—Ö—É–Ω–∫—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ python.
–ù–∞ —â–∞—Å—Ç—è –Ω–µ —Ç–∞–∫ —Å–∫–ª–∞–¥–Ω–æ –≤–∏—è–≤–∏–ª–æ—Å—å —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—é –≤—Å—å–æ–≥–æ –∫–æ–¥—É –≤ –Ω–∞—Ç–∏–≤–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é <a href="https://cython.org/" target="_blank" rel="noopener" >Cython</a>.</p>
<h2 id="–≤–∏—Å–Ω–æ–≤–∫–∏">–í–∏—Å–Ω–æ–≤–∫–∏</h2>
<p>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –≤–µ–∫—Ç–æ—Ä–Ω–∏—Ö –¥–∞–Ω–∏—Ö –º–æ–∂–µ –¥–∞—Ç–∏ –Ω–µ–ø–æ–≥–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞–ª–µ –≤ –ø—Ä–æ—Ü–µ—Å—ñ —á–∞—Å—Ç–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏ –∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—é –≥–µ–æ–º–µ—Ç—Ä—ñ—î—é —Ç–∞ –Ω–µ—Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω—ñ—Å—Ç—é —Ä–æ–∑–º—ñ—Ç–∫–∏.
–í –¥–µ—è–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö –≥–æ—Å—Ç—Ä–æ –≤—Å—Ç–∞—î –ø—Ä–æ–±–ª–µ–º–∞ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ –æ–±—Ä–∞—Ö—É–Ω–∫—ñ–≤ —ñ —à–≤–∏–¥–∫–æ–¥—ñ—ó.
–ê–ª–µ –≤ —Ü—ñ–π —Å—Ç–∞—Ç—Ç—ñ —è –Ω–∞–º–∞–≥–∞–≤—Å—è –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –∑ —Ü–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –º–æ–∂–Ω–∞ –≤–ø–æ—Ä–∞—Ç–∏—Å—å.</p>
<p>–¢–æ–≤–∞—Ä–∏—Å—Ç–≤–æ OSM –Ω–µ —Å—Ç–æ—ó—Ç—å –Ω–∞ –º—ñ—Å—Ü—ñ —ñ –ø–æ—Å—Ç—ñ–π–Ω–æ –ø–æ–∫—Ä–∞—â—É—î —Å–≤—ñ–π –ø—Ä–æ–¥—É–∫—Ç, —â–æ –≤ —Å–≤–æ—é —á–µ—Ä–≥—É –¥–æ–∑–≤–æ–ª—è—î –Ω–∞ —Ç–∞–∫–æ–º—É —Ö–æ—Ä–æ—à–æ–º—É –¥–∂–µ—Ä–µ–ª—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ–≤–æ–¥–∏—Ç–∏ –∫—É–ø—É –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å.
–†—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö OSM –¥–æ–∑–≤–æ–ª—è—î –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω—ñ –∑–æ–Ω–∏ –≤ –º–µ–∂–∞—Ö –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤, —â–æ –º–æ–∂–Ω–∞ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏ —è–∫ –≥–ª–æ–±–∞–ª—å–Ω–∏–π Urban Atlas.</p>
<p>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–≥–ª—è–Ω—É—Ç–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó –Ω–µ –æ–±–º–µ–∂—É—î—Ç—å—Å—è –º—ñ—Å—Ç–∞–º–∏, –∞ –¥–æ–∑–≤–æ–ª—è—î —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –≤ –±—É–¥—å-—è–∫–∏—Ö —ñ–Ω—à–∏—Ö —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—è—Ö –∑ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—É—Å—Ç–æ—é —Å—ñ—Ç–∫–æ—é –ª—ñ–Ω—ñ–π–Ω–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó.</p>
<p>–†–æ–∑–≤–∏—Ç–æ–∫ —Ä–µ—Å—É—Ä—Å—É OSM –∑–∞–±–µ–∑–ø–µ—á—É—î –≤—Å–µ –±—ñ–ª—å—à—É –∫–æ—Ä–∏—Å—Ç—å –≤—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É, —â–æ –Ω–∞–¥–∞–ª—ñ –º–æ–∂–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–º—ñ–Ω–∏—Ç–∏ —Ä—É—á–Ω—É —Ä–æ–±–æ—Ç—É –¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Å—É–ø—É—Ç–Ω–∏–∫–æ–≤–∏—Ö –∑–Ω—ñ–º–∫—ñ–≤.</p>
<p class="thank-you-for-attention üòâ">Thank you for attention!</p></main></div><footer>¬© Mikola Parfenyuck<div class="social-links"><a class="icon icon-twitter" rel="noopener" target="_blank" aria-label="My twitter" title="My twitter" href="https://twitter.com/i_rapkin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"><path d="M67.812 16.141a26.246 26.246 0 0 1-7.519 2.06 13.134 13.134 0 0 0 5.756-7.244 26.127 26.127 0 0 1-8.313 3.176A13.075 13.075 0 0 0 48.182 10c-7.229 0-13.092 5.861-13.092 13.093 0 1.026.118 2.021.338 2.981-10.885-.548-20.528-5.757-26.987-13.679a13.048 13.048 0 0 0-1.771 6.581c0 4.542 2.312 8.551 5.824 10.898a13.048 13.048 0 0 1-5.93-1.638c-.002.055-.002.11-.002.162 0 6.345 4.513 11.638 10.504 12.84a13.177 13.177 0 0 1-3.449.457c-.846 0-1.667-.078-2.465-.231 1.667 5.2 6.499 8.986 12.23 9.09a26.276 26.276 0 0 1-16.26 5.606A26.21 26.21 0 0 1 4 55.976a37.036 37.036 0 0 0 20.067 5.882c24.083 0 37.251-19.949 37.251-37.249 0-.566-.014-1.134-.039-1.694a26.597 26.597 0 0 0 6.533-6.774z"></path></svg>
</a><a class="icon icon-github" rel="noopener" target="_blank" aria-label="My github" title="My github" href="https://github.com/rapkin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
</a></div></footer><script src="/assets/js/bundle.js"></script></body></html>